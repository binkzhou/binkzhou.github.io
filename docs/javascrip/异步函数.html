<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>异步函数 | 我的笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/docs/assets/css/0.styles.52bb2005.css" as="style"><link rel="preload" href="/docs/assets/js/app.7890f91e.js" as="script"><link rel="preload" href="/docs/assets/js/2.a8bc3a53.js" as="script"><link rel="preload" href="/docs/assets/js/26.6dcfef0f.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.6d1a44dc.js"><link rel="prefetch" href="/docs/assets/js/11.88b33277.js"><link rel="prefetch" href="/docs/assets/js/12.d888dad3.js"><link rel="prefetch" href="/docs/assets/js/13.f4b320f4.js"><link rel="prefetch" href="/docs/assets/js/14.affc25d2.js"><link rel="prefetch" href="/docs/assets/js/15.f3f21810.js"><link rel="prefetch" href="/docs/assets/js/16.20cfbcd3.js"><link rel="prefetch" href="/docs/assets/js/17.8fa60e8f.js"><link rel="prefetch" href="/docs/assets/js/18.220db854.js"><link rel="prefetch" href="/docs/assets/js/19.c6db72e7.js"><link rel="prefetch" href="/docs/assets/js/20.121df49a.js"><link rel="prefetch" href="/docs/assets/js/21.b9b44369.js"><link rel="prefetch" href="/docs/assets/js/22.a7d81dee.js"><link rel="prefetch" href="/docs/assets/js/23.05a4db07.js"><link rel="prefetch" href="/docs/assets/js/24.0e35ee22.js"><link rel="prefetch" href="/docs/assets/js/25.9c3e07da.js"><link rel="prefetch" href="/docs/assets/js/27.6ad8c329.js"><link rel="prefetch" href="/docs/assets/js/28.6b5d3991.js"><link rel="prefetch" href="/docs/assets/js/29.407c6de9.js"><link rel="prefetch" href="/docs/assets/js/3.3ddcfe9a.js"><link rel="prefetch" href="/docs/assets/js/30.34551e96.js"><link rel="prefetch" href="/docs/assets/js/31.47783344.js"><link rel="prefetch" href="/docs/assets/js/32.c6f4cea4.js"><link rel="prefetch" href="/docs/assets/js/33.03d5e501.js"><link rel="prefetch" href="/docs/assets/js/34.0ca4e267.js"><link rel="prefetch" href="/docs/assets/js/35.e999eeee.js"><link rel="prefetch" href="/docs/assets/js/36.544af633.js"><link rel="prefetch" href="/docs/assets/js/37.9e0cc013.js"><link rel="prefetch" href="/docs/assets/js/38.1c3df97c.js"><link rel="prefetch" href="/docs/assets/js/39.9ce8a5f7.js"><link rel="prefetch" href="/docs/assets/js/4.72d66176.js"><link rel="prefetch" href="/docs/assets/js/40.323e7e25.js"><link rel="prefetch" href="/docs/assets/js/41.9440b8ee.js"><link rel="prefetch" href="/docs/assets/js/42.959d789d.js"><link rel="prefetch" href="/docs/assets/js/43.1a427e6d.js"><link rel="prefetch" href="/docs/assets/js/44.9adaa5b6.js"><link rel="prefetch" href="/docs/assets/js/45.b70993ab.js"><link rel="prefetch" href="/docs/assets/js/46.bc570f17.js"><link rel="prefetch" href="/docs/assets/js/47.954dd27f.js"><link rel="prefetch" href="/docs/assets/js/48.72d2a29d.js"><link rel="prefetch" href="/docs/assets/js/49.7ddfd074.js"><link rel="prefetch" href="/docs/assets/js/5.5087e4f8.js"><link rel="prefetch" href="/docs/assets/js/50.2684a6e6.js"><link rel="prefetch" href="/docs/assets/js/51.00572c60.js"><link rel="prefetch" href="/docs/assets/js/52.5a70be73.js"><link rel="prefetch" href="/docs/assets/js/53.9f6156b6.js"><link rel="prefetch" href="/docs/assets/js/54.9efed889.js"><link rel="prefetch" href="/docs/assets/js/55.78300585.js"><link rel="prefetch" href="/docs/assets/js/56.e33be804.js"><link rel="prefetch" href="/docs/assets/js/57.0c404d88.js"><link rel="prefetch" href="/docs/assets/js/58.2f99406b.js"><link rel="prefetch" href="/docs/assets/js/59.b7a3347e.js"><link rel="prefetch" href="/docs/assets/js/6.7a9273f7.js"><link rel="prefetch" href="/docs/assets/js/60.f14f3fe9.js"><link rel="prefetch" href="/docs/assets/js/61.f770fcc5.js"><link rel="prefetch" href="/docs/assets/js/62.9a22eb9a.js"><link rel="prefetch" href="/docs/assets/js/63.94b2ea39.js"><link rel="prefetch" href="/docs/assets/js/64.e2bf811b.js"><link rel="prefetch" href="/docs/assets/js/65.74d494f9.js"><link rel="prefetch" href="/docs/assets/js/66.a375bb32.js"><link rel="prefetch" href="/docs/assets/js/67.3c201101.js"><link rel="prefetch" href="/docs/assets/js/68.f2c6c1f4.js"><link rel="prefetch" href="/docs/assets/js/69.268faa44.js"><link rel="prefetch" href="/docs/assets/js/7.1a3a696f.js"><link rel="prefetch" href="/docs/assets/js/70.6f4df6a6.js"><link rel="prefetch" href="/docs/assets/js/71.37964dc5.js"><link rel="prefetch" href="/docs/assets/js/72.eef27e2e.js"><link rel="prefetch" href="/docs/assets/js/73.d7a9dbd9.js"><link rel="prefetch" href="/docs/assets/js/74.f2040aa6.js"><link rel="prefetch" href="/docs/assets/js/75.9f939c37.js"><link rel="prefetch" href="/docs/assets/js/76.b1358302.js"><link rel="prefetch" href="/docs/assets/js/77.83a2c6b3.js"><link rel="prefetch" href="/docs/assets/js/78.34149b3d.js"><link rel="prefetch" href="/docs/assets/js/79.fde21713.js"><link rel="prefetch" href="/docs/assets/js/8.9fb3aa96.js"><link rel="prefetch" href="/docs/assets/js/80.6461e24e.js"><link rel="prefetch" href="/docs/assets/js/81.e6c53d45.js"><link rel="prefetch" href="/docs/assets/js/82.19506b41.js"><link rel="prefetch" href="/docs/assets/js/83.b39f337e.js"><link rel="prefetch" href="/docs/assets/js/84.6dae4be4.js"><link rel="prefetch" href="/docs/assets/js/85.862470ad.js"><link rel="prefetch" href="/docs/assets/js/86.6121868f.js"><link rel="prefetch" href="/docs/assets/js/87.7c0c10bf.js"><link rel="prefetch" href="/docs/assets/js/88.24fd0017.js"><link rel="prefetch" href="/docs/assets/js/9.24bd0981.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.52bb2005.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">我的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/javascrip/" class="nav-link router-link-active">
  JavaScrip
</a></li><li class="dropdown-item"><!----> <a href="/docs/typescrip/" class="nav-link">
  TypeScrip
</a></li><li class="dropdown-item"><!----> <a href="/docs/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/docs/hook/" class="nav-link">
  Hook
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/docs/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/docs/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/docs/j2ee/" class="nav-link">
  J2EE
</a></li><li class="dropdown-item"><!----> <a href="/docs/ssm/" class="nav-link">
  SSM
</a></li></ul></div></div><div class="nav-item"><a href="/docs/efficiency/1.常用网站.html" class="nav-link">
  随记
</a></div><div class="nav-item"><a href="/docs/collection/1.立即执行函数.html" class="nav-link">
  收藏
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/docs/javascrip/" class="nav-link router-link-active">
  JavaScrip
</a></li><li class="dropdown-item"><!----> <a href="/docs/typescrip/" class="nav-link">
  TypeScrip
</a></li><li class="dropdown-item"><!----> <a href="/docs/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/docs/hook/" class="nav-link">
  Hook
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue3/" class="nav-link">
  Vue3
</a></li><li class="dropdown-item"><!----> <a href="/docs/webpack/" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/docs/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/docs/j2ee/" class="nav-link">
  J2EE
</a></li><li class="dropdown-item"><!----> <a href="/docs/ssm/" class="nav-link">
  SSM
</a></li></ul></div></div><div class="nav-item"><a href="/docs/efficiency/1.常用网站.html" class="nav-link">
  随记
</a></div><div class="nav-item"><a href="/docs/collection/1.立即执行函数.html" class="nav-link">
  收藏
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/javascrip/" aria-current="page" class="sidebar-link">语言基础</a></li><li><a href="/docs/javascrip/异步函数.html" class="active sidebar-link">异步函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#promise基本使用" class="sidebar-link">Promise基本使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#起步" class="sidebar-link">起步</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#传递参数" class="sidebar-link">传递参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#案例" class="sidebar-link">案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#读取文件案例" class="sidebar-link">读取文件案例</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#发送ajax案例" class="sidebar-link">发送AJAX案例</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#封装读取文件" class="sidebar-link">封装读取文件</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#封装ajax请求" class="sidebar-link">封装AJAX请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#promise中的对象和值" class="sidebar-link">Promise中的对象和值</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#promise的状态" class="sidebar-link">Promise的状态</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#promise对象的值" class="sidebar-link">Promise对象的值</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#promise中的api" class="sidebar-link">Promise中的api</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#catch" class="sidebar-link">catch</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#resolve" class="sidebar-link">resolve</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#reject" class="sidebar-link">reject</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#all" class="sidebar-link">all</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#race" class="sidebar-link">race</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#promise关键问题" class="sidebar-link">promise关键问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#状态改变" class="sidebar-link">状态改变</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#执行多个回调" class="sidebar-link">执行多个回调</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#改变状态与指定回调顺序问题" class="sidebar-link">改变状态与指定回调顺序问题</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#返回结果由谁决定" class="sidebar-link">返回结果由谁决定</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#串联多个任务" class="sidebar-link">串联多个任务</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#异常穿透现象" class="sidebar-link">异常穿透现象</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#中断promise链" class="sidebar-link">中断promise链</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#async与await" class="sidebar-link">async与await</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#async函数" class="sidebar-link">async函数</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#await-表达式" class="sidebar-link">await 表达式</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#await案例" class="sidebar-link">await案例</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#手写promise" class="sidebar-link">手写promise</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#初始结构搭建" class="sidebar-link">初始结构搭建</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#resolve和reject结构搭建" class="sidebar-link">resolve和reject结构搭建</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#改变promise状态" class="sidebar-link">改变promise状态</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#throw抛出异常" class="sidebar-link">throw抛出异常</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#实现状态只能修改一次" class="sidebar-link">实现状态只能修改一次</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#then方法执行回调" class="sidebar-link">then方法执行回调</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#执行异步任务回调" class="sidebar-link">执行异步任务回调</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#执行多个回调-2" class="sidebar-link">执行多个回调</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#同步修改then方法结果返回值" class="sidebar-link">同步修改then方法结果返回值</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#异步修改then方法结果返回值" class="sidebar-link">异步修改then方法结果返回值</a></li><li class="sidebar-sub-header"><a href="/docs/javascrip/异步函数.html#优化" class="sidebar-link">优化</a></li></ul></li></ul></li><li><a href="/docs/javascrip/集合引用类型.html" class="sidebar-link">集合引用类型</a></li><li><a href="/docs/javascrip/对象_类.html" class="sidebar-link">对象-类</a></li><li><a href="/docs/javascrip/函数.html" class="sidebar-link">函数</a></li><li><a href="/docs/javascrip/canvas.html" class="sidebar-link">动画与canvas</a></li><li><a href="/docs/javascrip/dom.html" class="sidebar-link">DOM</a></li><li><a href="/docs/javascrip/bom.html" class="sidebar-link">BOM</a></li><li><a href="/docs/javascrip/模块化规范.html" class="sidebar-link">模块化规范</a></li><li><a href="/docs/javascrip/手写常用函数.html" class="sidebar-link">手写常用函数</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="promise基本使用"><a href="#promise基本使用" class="header-anchor">#</a> Promise基本使用</h2> <h3 id="起步"><a href="#起步" class="header-anchor">#</a> 起步</h3> <p>①我们可以用 <code>new Promise(executor)</code> 创建一个promise对象，该构造函数会把一个叫做“处理器函数”（executor function）的函数作为它的参数。</p> <p>②这个“处理器函数”接受两个函数——<code>resolve</code> 和 <code>reject</code> ——作为其参数。</p> <p>③当异步任务顺利完成且返回结果值时，会调用 <code>resolve</code> 函数；而当异步任务失败且返回失败原因（通常是一个错误对象）时，会调用<code>reject</code> 函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//返回成功的状态</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise状态设置为[成功]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//PromiseState: &quot;fulfilled&quot;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//返回成功的状态</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise状态设置为[失败]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//PromiseState: &quot;rejected&quot;</span>
</code></pre></div><h3 id="传递参数"><a href="#传递参数" class="header-anchor">#</a> 传递参数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//成功传递参数</span>
<span class="token keyword">var</span> promise <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Promise状态设置为[成功]并传递参数</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//接受到成功的回调</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//接受到失败的回调</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//success</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> promise <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;erro&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//接受到成功的回调</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//接受到失败的回调</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//erro</span>
</code></pre></div><h2 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h2> <h3 id="读取文件案例"><a href="#读取文件案例" class="header-anchor">#</a> 读取文件案例</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 异步函数</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resource/content.txt'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="发送ajax案例"><a href="#发送ajax案例" class="header-anchor">#</a> 发送AJAX案例</h3> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Promise基本使用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Promise初体验<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>点击抽奖<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">//1.创建对象</span>
                <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//2.初始化</span>
                xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span><span class="token string">'https://api.apiopen.top/getJoke'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//3.发生</span>
                xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//4.处理相应</span>
                xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token comment">//判断相应状态码2xx</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token operator">&gt;=</span><span class="token number">200</span><span class="token operator">&amp;&amp;</span>xhr<span class="token punctuation">.</span>status<span class="token operator">&lt;</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token comment">//控制台输出相应体</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                            <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="封装读取文件"><a href="#封装读取文件" class="header-anchor">#</a> 封装读取文件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 封装一个函数mineReadFile 读取文件内容
 * 参数：path 文件路径
 * 返回：promise 对象
 */</span>

 <span class="token keyword">function</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         <span class="token comment">//读取文件</span>
         <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
             <span class="token comment">//判断</span>
             <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token comment">//成功</span>
             <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>

 <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./resource/content.txt'</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="封装ajax请求"><a href="#封装ajax请求" class="header-anchor">#</a> 封装AJAX请求</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * 封装一个函数 sendAJAX发送GET AJAX请求
 * 参数 URL
 * 返回结果 Promise 对象
 */</span>
<span class="token keyword">function</span> <span class="token function">sendAJAX</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//处理结果</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//判断成功</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;=</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">sendAJAX</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/getJoke'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sendAJAX</span><span class="token punctuation">(</span><span class="token string">'https://api.apiopen.top/getJoke'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="promise中的对象和值"><a href="#promise中的对象和值" class="header-anchor">#</a> Promise中的对象和值</h2> <h3 id="promise的状态"><a href="#promise的状态" class="header-anchor">#</a> Promise的状态</h3> <p>实例对象中的一个属性 [[PromiseState]]</p> <ul><li><p>pending 未决定的</p></li> <li><p>resolved / fullfilled 成功</p></li> <li><p>reject 失败</p></li></ul> <p>注意</p> <ul><li><p>只能由pending-&gt;resolved / fullfilled或pending-&gt;reject</p></li> <li><p>不能 resolved/ fullfilled&lt;—&gt;reject</p></li></ul> <h3 id="promise对象的值"><a href="#promise对象的值" class="header-anchor">#</a> Promise对象的值</h3> <p>实例对象中的另一个属性[[PromiseResult]]</p> <p>保存异步任务[成功/失败]的结果</p> <p>resolve和reject可以修改PromiseResult中的值</p> <h2 id="promise中的api"><a href="#promise中的api" class="header-anchor">#</a> Promise中的api</h2> <h3 id="catch"><a href="#catch" class="header-anchor">#</a> catch</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//Promise构造函数:Promise(excutor){}</span>
<span class="token comment">//excutor函数：执行器(resolve,reject)=&gt;{}</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'erro'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//失败回调函数</span>
p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="resolve"><a href="#resolve" class="header-anchor">#</a> resolve</h3> <ul><li>如果传入的参数为非promise类型的对象，则返回的结果为成功promise对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>如果传入的参数为Promise对象，则参数的结果决定了resolve的结果</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="reject"><a href="#reject" class="header-anchor">#</a> reject</h3> <p>不管传入的是不是promise对象都是失败</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="all"><a href="#all" class="header-anchor">#</a> all</h3> <ul><li><p>全部成功才成功，返回所有结果为数组</p></li> <li><p>一个失败则失败，返回失败的结果</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//成功的例子</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Oh Yeah'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//失败的例子</span>
<span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Oh Yeah'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="race"><a href="#race" class="header-anchor">#</a> race</h3> <p>最先完成的决定结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// resolve('ok');</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Oh Yeah'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//最先完成的决定结果</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">,</span>p3<span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="promise关键问题"><a href="#promise关键问题" class="header-anchor">#</a> promise关键问题</h2> <h3 id="状态改变"><a href="#状态改变" class="header-anchor">#</a> 状态改变</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//1.resolve函数</span>
    <span class="token comment">//resolve('ok'); //pending =&gt; fulfilled (resolve)</span>
    <span class="token comment">//2.reject函数</span>
    <span class="token comment">//reject('erro'); //pending =&gt; reject</span>
    <span class="token comment">//3.抛出错误</span>
    <span class="token keyword">throw</span> <span class="token string">'出问题了'</span><span class="token punctuation">;</span> <span class="token comment">//pending =&gt; reject</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="执行多个回调"><a href="#执行多个回调" class="header-anchor">#</a> 执行多个回调</h3> <p>指定每一个回调都会被执行</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//指定回调 1</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ok</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//指定回调 2</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ok</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//666</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="改变状态与指定回调顺序问题"><a href="#改变状态与指定回调顺序问题" class="header-anchor">#</a> 改变状态与指定回调顺序问题</h3> <ul><li>同步任务先改变状态后指定回调</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//同步任务先改变状态后指定回调</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>异步任务先指定回调后改变状态</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//异步任务先指定回调后改变状态</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="返回结果由谁决定"><a href="#返回结果由谁决定" class="header-anchor">#</a> 返回结果由谁决定</h3> <p>无返回值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//执行then方法</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ok</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// [[PromiseState]]: &quot;fulfilled&quot;</span>
<span class="token comment">// [[PromiseResult]]: undefined</span>
</code></pre></div><p>抛出错误</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//执行then方法</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//抛出错误</span>
    <span class="token keyword">throw</span> <span class="token string">'出了问题'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [[PromiseState]]: &quot;rejected&quot;</span>
<span class="token comment">// [[PromiseResult]]: &quot;出了问题&quot;</span>
</code></pre></div><p>返回结果是非promise对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//执行then方法</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//返回结果是非promise对象</span>
    <span class="token keyword">return</span> <span class="token number">500</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [[PromiseState]]: &quot;fulfilled&quot;</span>
<span class="token comment">// [[PromiseResult]]: 500</span>
</code></pre></div><p>返回值是promise对象</p> <ul><li>如果promise对象的返回值成功则成功</li> <li>如果promise对象的返回值失败则失败</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//执行then方法</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//3.返回结果是promise对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         <span class="token comment">//resolve('success');</span>
         <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'erro'</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [[PromiseState]]: &quot;rejected&quot;</span>
<span class="token comment">// [[PromiseResult]]: &quot;erro&quot;</span>
</code></pre></div><h3 id="串联多个任务"><a href="#串联多个任务" class="header-anchor">#</a> 串联多个任务</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// return 007;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="异常穿透现象"><a href="#异常穿透现象" class="header-anchor">#</a> 异常穿透现象</h3> <p>任何一个环节出错都会被catch捕获</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// reject('erro');</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// console.log(222);</span>
    <span class="token keyword">throw</span> <span class="token string">'出错了'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="中断promise链"><a href="#中断promise链" class="header-anchor">#</a> 中断promise链</h3> <p>返回一个空的promise对象就可以中断promise链<code>return new Promise(()=&gt;{})</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//中断promise链：返回一个pending状态的promse对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">333</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="async与await"><a href="#async与await" class="header-anchor">#</a> async与await</h2> <h3 id="async函数"><a href="#async函数" class="header-anchor">#</a> async函数</h3> <p>1.函数的返回值为promise对象</p> <p>2.promise对象的结果有async函数执行的返回值决定</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//result是一个promise对象</span>
<span class="token comment">//[[PromiseState]]: &quot;fulfilled&quot;</span>
<span class="token comment">//[[PromiseResult]]: undefined</span>
</code></pre></div><h4 id="返回一个非promise对象"><a href="#返回一个非promise对象" class="header-anchor">#</a> 返回一个非promise对象</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//如果返回是一个非promise类型的数据</span>
	<span class="token keyword">return</span> <span class="token number">521</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// [[PromiseState]]: &quot;fulfilled&quot;</span>
<span class="token comment">// [[PromiseResult]]: 521</span>
</code></pre></div><h4 id="返回一个promise对象"><a href="#返回一个promise对象" class="header-anchor">#</a> 返回一个promise对象</h4> <p>返回结果的状态由promise的结果决定</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//如果返回的是一个promise对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;出错了&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//[[PromiseState]]: &quot;rejected&quot;</span>
<span class="token comment">//[[PromiseResult]]: &quot;出错了&quot;</span>
</code></pre></div><h4 id="如果抛出一个错误"><a href="#如果抛出一个错误" class="header-anchor">#</a> 如果抛出一个错误</h4> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//3.抛出异常</span>
	<span class="token keyword">throw</span> <span class="token string">&quot;oh  NO&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// [[PromiseState]]: &quot;rejected&quot;</span>
<span class="token comment">// [[PromiseResult]]: &quot;oh  NO&quot;</span>
</code></pre></div><h3 id="await-表达式"><a href="#await-表达式" class="header-anchor">#</a> await 表达式</h3> <p>1.await右侧的表达式一般为promise对象，但也可以是其它的值</p> <p>2.如果表达式时promise对象,await返回的是promise成功的值</p> <p>3.如果表达式是其它值，直接将此值作为await的返回值</p> <p>注意：</p> <p>1.await必须写在async函数中，但async函数中可以没有await</p> <p>2.如果await的promise失败了，就会抛出异常，需要try...catch捕获处理</p> <h4 id="右侧是promise对象"><a href="#右侧是promise对象" class="header-anchor">#</a> 右侧是promise对象</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">//右侧为promise对象的情况</span>
	<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> p<span class="token punctuation">;</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//log输出的结果 OK</span>
</code></pre></div><h4 id="右侧是其他类型的值"><a href="#右侧是其他类型的值" class="header-anchor">#</a> 右侧是其他类型的值</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//右侧为其他类型的数据</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">20</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//log输出的结果 20</span>
</code></pre></div><h4 id="promise失败的情况"><a href="#promise失败的情况" class="header-anchor">#</a> promise失败的情况</h4> <p>需要通过try...catch进行捕获</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    	<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&quot;出错了&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">//promise失败的情况</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
    	<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//log输出的结果 出错了</span>
</code></pre></div><h3 id="await案例"><a href="#await案例" class="header-anchor">#</a> await案例</h3> <p>要求：读取三个文件的内容并拼接在一起</p> <h4 id="不使用await函数完成"><a href="#不使用await函数完成" class="header-anchor">#</a> 不使用await函数完成</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resource/1.txt'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data1</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resource/2.txt'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data2</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./resource/3.txt'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data3</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data1<span class="token operator">+</span>data2<span class="token operator">+</span>data3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">/*
我是第一个文件的内容
我是第二个文件的内容
我是第三个文件的内容
*/</span>
</code></pre></div><h4 id="使用await函数简化"><a href="#使用await函数简化" class="header-anchor">#</a> 使用await函数简化</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将fs转换为promise对象</span>
<span class="token keyword">const</span> mineReadFile <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//读取第文件的内容</span>
        <span class="token keyword">let</span> data1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./resource/1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./resource/2.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">mineReadFile</span><span class="token punctuation">(</span><span class="token string">'./resource/3.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data1<span class="token operator">+</span>data2<span class="token operator">+</span>data3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;读取文件出错了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/*
我是第一个文件的内容
我是第二个文件的内容
我是第三个文件的内容
*/</span>
</code></pre></div><h2 id="手写promise"><a href="#手写promise" class="header-anchor">#</a> 手写promise</h2> <h3 id="初始结构搭建"><a href="#初始结构搭建" class="header-anchor">#</a> 初始结构搭建</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// executor执行器=&gt;是一个函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//测试代码,省略html的js导入</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行结果</p> <p><img src="/docs/assets/img/1622379437704.a4f10e03.png" alt="1622379437704"></p> <h3 id="resolve和reject结构搭建"><a href="#resolve和reject结构搭建" class="header-anchor">#</a> resolve和reject结构搭建</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//同步调用[执行器函数]</span>
    <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p><strong>详解:</strong> 将执行器传递到promise并调用了promise中的resolve方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// executor(resolve,reject);相当于</span>
<span class="token keyword">const</span> <span class="token function-variable function">executor</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 调用resolve传递过来的</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//测试代码,省略html的js导入</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>效果</p> <p><img src="data:image/png;base64,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" alt="1622380103383"></p> <h3 id="改变promise状态"><a href="#改变promise状态" class="header-anchor">#</a> 改变promise状态</h3> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'reject'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//同步调用[执行器函数]</span>
    <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//测试代码,省略html的js导入</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>运行结果</strong></p> <p><img src="data:image/png;base64,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" alt="1622380731425"></p> <h3 id="throw抛出异常"><a href="#throw抛出异常" class="header-anchor">#</a> throw抛出异常</h3> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'reject'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">throw</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>效果</p> <p><img src="/docs/assets/img/1622381000992.6b5e9beb.png" alt="1622381000992"></p> <h3 id="实现状态只能修改一次"><a href="#实现状态只能修改一次" class="header-anchor">#</a> 实现状态只能修改一次</h3> <p>思路：判断是否之前被改过，如果被改过不再更改</p> <p>{13,22}</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre></div><p>测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>效果</p> <p><img src="data:image/png;base64,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" alt="1622381385624"></p> <h3 id="then方法执行回调"><a href="#then方法执行回调" class="header-anchor">#</a> then方法执行回调</h3> <p>思路：通过PromiseState判断状态,通过PromiseResult获取存放的值</p> <p>{39-47}</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 调用回调函数 PromiseState</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>then方法详解</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 相当于</span>
<span class="token keyword">const</span> <span class="token function-variable function">onResolved</span> <span class="token operator">=</span> <span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span>
</code></pre></div><p>测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>运行结果</p> <p><img src="data:image/png;base64,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" alt="1622380103383"></p> <h3 id="执行异步任务回调"><a href="#执行异步任务回调" class="header-anchor">#</a> 执行异步任务回调</h3> <p>思路：在resolve函数中不能执行到then方法，所以我们需要执行then方法的时候将其保存，到异步事件到后再调用</p> <p>{7,57-64,21-23,34-36}</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callback <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用成功的回调函数</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>callback<span class="token punctuation">.</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">{</span>
            _this<span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用失败的回调函数</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>callback<span class="token punctuation">.</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">{</span>
            _this<span class="token punctuation">.</span>callback<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 调用回调函数 PromiseState</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//判断pedding状态</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//保存回调函数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callback <span class="token operator">=</span> <span class="token punctuation">{</span>
            onResolved<span class="token operator">:</span>onResolved<span class="token punctuation">,</span>
            onRejected<span class="token operator">:</span>onRejected
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>1秒后运行结果</p> <p><img src="data:image/png;base64,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" alt="1622380103383"></p> <h3 id="执行多个回调-2"><a href="#执行多个回调-2" class="header-anchor">#</a> 执行多个回调</h3> <p>实现思路：将所以回调保存到数组中，然后遍历调用</p> <p>{7,21-23,34-36,58-64}</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用成功的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用失败的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 调用回调函数 PromiseState</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//判断pedding状态</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//保存回调函数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            onResolved<span class="token operator">:</span>onResolved<span class="token punctuation">,</span>
            onRejected<span class="token operator">:</span>onRejected
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">alert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">alert</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>运行结果</p> <p><img src="/docs/assets/img/1622383219805.c0600b68.png" alt="1622383219805"></p> <h3 id="同步修改then方法结果返回值"><a href="#同步修改then方法结果返回值" class="header-anchor">#</a> 同步修改then方法结果返回值</h3> <p>无返回值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//执行then方法</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//ok</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// PromiseState: &quot;fulfilled&quot; PromiseResult: undefined</span>
</code></pre></div><p>抛出错误</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//抛出错误</span>
    <span class="token keyword">throw</span> <span class="token string">'出了问题'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// PromiseState: &quot;rejected&quot; PromiseResult: &quot;出了问题&quot;</span>
</code></pre></div><p>返回结果是非promise对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//返回结果是非promise对象</span>
    <span class="token keyword">return</span> <span class="token number">500</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// PromiseState: &quot;fulfilled&quot; PromiseResult: 500</span>
</code></pre></div><p>返回值是promise对象</p> <ul><li>如果promise对象的返回值成功则成功</li> <li>如果promise对象的返回值失败则失败</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> result <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//3.返回结果是promise对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         <span class="token comment">//resolve('success');</span>
         <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'erro'</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// PromiseState: &quot;rejected&quot; PromiseResult: &quot;erro&quot;</span>
</code></pre></div><p><strong>实现思路</strong></p> <p><strong>1.返回值为：无返回值或返回值为非promise对象</strong></p> <p>思路：如果返回函数执行结果为非promise对象，则修改状态为成功</p> <p>{50,52-62}</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用成功的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用失败的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 调用回调函数 PromiseState</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 获取回调函数的执行结果</span>
            <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 判断</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">//结果的对象状态为成功</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断pedding状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//保存回调函数</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                onResolved<span class="token operator">:</span>onResolved<span class="token punctuation">,</span>
                onRejected<span class="token operator">:</span>onRejected
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码</p> <p>{5-6}</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// console.log(value);</span>
    <span class="token keyword">return</span> <span class="token string">'hello Promise'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/docs/assets/img/1622943927042.f7f14552.png" alt="1622943927042"></p> <p><strong>2.返回值为promise对象</strong></p> <p>思路：将返回状态设为promise对象状态，返回值设置为promise对象返回值。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用成功的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用失败的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 调用回调函数 PromiseState</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 获取回调函数的执行结果</span>
            <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 判断</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//如果返回结果是promise对象</span>
                result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">//结果的对象状态为成功</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断pedding状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//保存回调函数</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                onResolved<span class="token operator">:</span>onResolved<span class="token punctuation">,</span>
                onRejected<span class="token operator">:</span>onRejected
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/docs/assets/img/1622943871138.94d2d531.png" alt="1622943871138"></p> <p><strong>3.抛出异常</strong></p> <p>实现思路：通过trycatch进行包裹，返回状态为失败，并设置失败值为抛出的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用成功的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用失败的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 调用回调函数 PromiseState</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取回调函数的执行结果</span>
                <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 判断</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//如果返回结果是promise对象</span>
                    result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token comment">//结果的对象状态为成功</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断pedding状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//保存回调函数</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                onResolved<span class="token operator">:</span>onResolved<span class="token punctuation">,</span>
                onRejected<span class="token operator">:</span>onRejected
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token keyword">throw</span> <span class="token string">'FAIL'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>运行结果</p> <p><img src="/docs/assets/img/1622944171743.790ac3cf.png" alt="1622944171743"></p> <h3 id="异步修改then方法结果返回值"><a href="#异步修改then方法结果返回值" class="header-anchor">#</a> 异步修改then方法结果返回值</h3> <div class="language-JS extra-class"><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用成功的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用失败的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 调用回调函数 PromiseState</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取回调函数的执行结果</span>
                <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 判断</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//如果返回结果是promise对象</span>
                    result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token comment">//结果的对象状态为成功</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断pedding状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//保存回调函数</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token function-variable function">onResolved</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 获取回调函数的执行结果</span>
                        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 判断</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token comment">//如果返回结果是promise对象</span>
                            result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                                <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                                <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                            <span class="token comment">//结果的对象状态为成功</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">onRejected</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 获取回调函数的执行结果</span>
                        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 判断</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token comment">//如果返回结果是promise对象</span>
                            result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                                <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                                <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                            <span class="token comment">//结果的对象状态为成功</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	<span class="token comment">// return 'success';</span>
	<span class="token keyword">throw</span> <span class="token string">'FAIL'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">reason</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/docs/assets/img/1622945800443.64afa056.png" alt="1622945800443"></p> <h3 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h3> <p>存在重复代码需要优化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//声明构造函数</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//添加属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'pending'</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//声明属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//保存实例对象的this的值</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

    <span class="token comment">//resolve函数</span>
    <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'fulfilled'</span><span class="token punctuation">;</span> <span class="token comment">//resolved</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用成功的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onResolved</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 判断状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseState <span class="token operator">!==</span> <span class="token string">'pending'</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//1.修改对象状态(promiseState)</span>
        _this<span class="token punctuation">.</span>PromiseState <span class="token operator">=</span> <span class="token string">'rejected'</span><span class="token punctuation">;</span> <span class="token comment">//reject</span>
        <span class="token comment">//2.设置对象结果值(promiseResult)</span>
        _this<span class="token punctuation">.</span>PromiseResult <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token comment">//调用失败的回调函数</span>
        _this<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//同步调用[执行器函数]</span>
        <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//添加then方法</span>
<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">//封装函数</span>
        <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 获取回调函数的执行结果</span>
                <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>_this<span class="token punctuation">.</span>PromiseResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 判断</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//如果返回结果是promise对象</span>
                    result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">r</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                        <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token comment">//结果的对象状态为成功</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 调用回调函数 PromiseState</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'fulfilled'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'rejected'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断pedding状态</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PromiseState <span class="token operator">===</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//保存回调函数</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token function-variable function">onResolved</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">callback</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">onRejected</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">callback</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/javascrip/" class="prev router-link-active">
        语言基础
      </a></span> <span class="next"><a href="/docs/javascrip/集合引用类型.html">
        集合引用类型
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.7890f91e.js" defer></script><script src="/docs/assets/js/2.a8bc3a53.js" defer></script><script src="/docs/assets/js/26.6dcfef0f.js" defer></script>
  </body>
</html>
